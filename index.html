<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>South Park Digital Pet</title>

<style>
:root {
    --border: 4px solid #000;
    --shadow: 0 8px 20px rgba(0,0,0,.3);
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Arial Black', Arial, sans-serif;
    background: linear-gradient(to bottom, #87CEEB, #90EE90);
    min-height: 100vh;
    padding: 16px;
}

.container {
    max-width: 900px;
    margin: auto;
}

h1 {
    font-size: clamp(2.2rem, 6vw, 3rem);
    color: white;
    text-shadow: 4px 4px 0 #000;
    text-align: center;
    margin-bottom: 10px;
}

.subtitle {
    text-align: center;
    font-size: clamp(1.1rem, 3vw, 1.5rem);
    color: white;
    margin-bottom: 30px;
}

/* CHARACTER SELECT */

.char-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 16px;
    margin-bottom: 30px;
}

.char-card {
    background: white;
    border: var(--border);
    padding: 16px;
    text-align: center;
    cursor: pointer;
    transition: .2s;
}

.char-card:hover {
    background: #fff9c4;
    transform: scale(1.05);
}

.char-img {
    width: 100%;
    max-width: 120px;
    height: auto;
    margin: auto;
}

.char-name {
    margin-top: 10px;
    font-size: 1.1rem;
}

/* BUTTONS */

.btn {
    width: 100%;
    padding: 14px;
    font-size: 1.1rem;
    font-weight: bold;
    border: var(--border);
    cursor: pointer;
}

.load-btn {
    background: #4169E1;
    color: white;
}

/* GAME SCREEN */

#gameScreen {
    display: none;
    background: white;
    border: 6px solid #000;
    padding: clamp(16px, 3vw, 30px);
    box-shadow: var(--shadow);
}

.header {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.header h2 {
    font-size: clamp(1.4rem, 4vw, 2rem);
}

.header-btns {
    display: flex;
    gap: 10px;
}

.save-btn, .exit-btn {
    padding: 10px 14px;
    font-weight: bold;
    border: var(--border);
    cursor: pointer;
}

.save-btn { background: #28a745; color: white; }
.exit-btn { background: #dc3545; color: white; }

/* PET DISPLAY */

.pet-display {
    background: linear-gradient(to bottom, #ADD8E6, #90EE90);
    border: var(--border);
    padding: 30px;
    min-height: 220px;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 20px;
}

.pet-sprite {
    width: min(220px, 60vw);
    transition: transform .3s;
}

.pet-sprite.animate {
    animation: bounce .5s;
}

@keyframes bounce {
    50% { transform: translateY(-15px) scale(1.1); }
}

/* STATS */

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 16px;
    margin-bottom: 20px;
}

.stat {
    border: var(--border);
    background: #f2f2f2;
    padding: 12px;
}

.stat-header {
    display: flex;
    gap: 8px;
    font-size: 1rem;
    margin-bottom: 6px;
}

.stat-bar {
    height: 24px;
    background: #ccc;
    border: 2px solid #000;
    overflow: hidden;
}

.stat-fill {
    height: 100%;
    transition: width .4s;
}

.high { background: #28a745; }
.medium { background: #ffc107; }
.low { background: #dc3545; }

.stat-value {
    text-align: right;
    font-size: .9rem;
    margin-top: 4px;
}

/* ACTIONS */

.actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 12px;
}

.action-btn {
    padding: 14px;
    border: var(--border);
    font-weight: bold;
    cursor: pointer;
    transition: .2s;
}

.action-btn:hover {
    transform: translateY(-4px);
}

.feed { background: #ffd700; }
.play { background: #ff69b4; }
.clean { background: #87ceeb; }
.sleep { background: #9370db; }

.icon {
    font-size: 1.8rem;
    display: block;
}

input[type="file"] {
    display: none;
}
</style>
</head>

<body>
<div class="container">

<div id="selectScreen">
    <h1>SOUTH PARK PETS</h1>
    <p class="subtitle">Pick your buddy!</p>

    <div class="char-grid">
        <div class="char-card" onclick="selectCharacter('stan','Stan','1.png')">
            <img src="1.png" class="char-img">
            <div class="char-name">Stan</div>
        </div>
        <div class="char-card" onclick="selectCharacter('kyle','Kyle','2.png')">
            <img src="2.png" class="char-img">
            <div class="char-name">Kyle</div>
        </div>
        <div class="char-card" onclick="selectCharacter('cartman','Cartman','3.png')">
            <img src="3.png" class="char-img">
            <div class="char-name">Cartman</div>
        </div>
        <div class="char-card" onclick="selectCharacter('kenny','Kenny','4.png')">
            <img src="4.png" class="char-img">
            <div class="char-name">Kenny</div>
        </div>
    </div>

    <button class="btn load-btn" onclick="fileInput.click()">üìÅ Load Save (.sps)</button>
    <input type="file" id="fileInput" accept=".sps">
</div>

<div id="gameScreen">
    <div class="header">
        <h2 id="petName"></h2>
        <div class="header-btns">
            <button class="save-btn" onclick="saveToFile()">üíæ Save</button>
            <button class="exit-btn" onclick="exitGame()">‚ùå Exit</button>
        </div>
    </div>

    <div class="pet-display">
        <img id="petSprite" class="pet-sprite">
    </div>

    <div class="stats-grid">
        <div class="stat"><div class="stat-header">üçó Hunger</div><div class="stat-bar"><div id="hungerBar" class="stat-fill high"></div></div><div id="hungerValue" class="stat-value"></div></div>
        <div class="stat"><div class="stat-header">‚ù§Ô∏è Happiness</div><div class="stat-bar"><div id="happyBar" class="stat-fill high"></div></div><div id="happyValue" class="stat-value"></div></div>
        <div class="stat"><div class="stat-header">‚ú® Hygiene</div><div class="stat-bar"><div id="hygieneBar" class="stat-fill high"></div></div><div id="hygieneValue" class="stat-value"></div></div>
        <div class="stat"><div class="stat-header">üåô Energy</div><div class="stat-bar"><div id="energyBar" class="stat-fill high"></div></div><div id="energyValue" class="stat-value"></div></div>
    </div>

    <div class="actions">
        <button class="action-btn feed" onclick="performAction('feed')"><span class="icon">üçó</span>Feed</button>
        <button class="action-btn play" onclick="performAction('play')"><span class="icon">‚ù§Ô∏è</span>Play</button>
        <button class="action-btn clean" onclick="performAction('clean')"><span class="icon">‚ú®</span>Clean</button>
        <button class="action-btn sleep" onclick="performAction('sleep')"><span class="icon">üåô</span>Sleep</button>
    </div>
</div>
</div>

<script>
let gameState = {
    character:null,
    characterName:'',
    characterImage:'',
    stats:{hunger:100,happiness:100,hygiene:100,energy:100,age:0},
    lastUpdate:Date.now()
};

let interval;

fileInput.onchange = e => {
    const file = e.target.files[0];
    if (!file || !file.name.endsWith('.sps')) {
        alert('Only .sps files are allowed');
        return;
    }
    const r = new FileReader();
    r.onload = () => {
        try {
            const data = JSON.parse(r.result);
            gameState = data;
            startGame();
        } catch {
            alert('Invalid save file');
        }
    };
    r.readAsText(file);
};

function selectCharacter(id,name,img){
    gameState.character=id;
    gameState.characterName=name;
    gameState.characterImage=img;
    gameState.lastUpdate=Date.now();
    startGame();
}

function startGame(){
    selectScreen.style.display='none';
    gameScreen.style.display='block';
    petName.textContent=gameState.characterName+"'s Pet";
    petSprite.src=gameState.characterImage;
    if(interval) clearInterval(interval);
    interval=setInterval(decay,1000);
    update();
}

function decay(){
    const now=Date.now();
    const t=(now-gameState.lastUpdate)/1000;
    gameState.stats.hunger=Math.max(0,gameState.stats.hunger-t*.5);
    gameState.stats.happiness=Math.max(0,gameState.stats.happiness-t*.3);
    gameState.stats.hygiene=Math.max(0,gameState.stats.hygiene-t*.2);
    gameState.stats.energy=Math.max(0,gameState.stats.energy-t*.4);
    gameState.lastUpdate=now;
    update();
}

function update(){
    draw('hunger');draw('happy','happiness');draw('hygiene');draw('energy');
}

function draw(id,key=id){
    const v=gameState.stats[key];
    const bar=document.getElementById(id+'Bar');
    const val=document.getElementById(id+'Value');
    bar.style.width=v+'%';
    val.textContent=Math.round(v)+'%';
    bar.className='stat-fill '+(v>70?'high':v>40?'medium':'low');
}

function performAction(a){
    petSprite.classList.add('animate');
    setTimeout(()=>petSprite.classList.remove('animate'),500);
    if(a==='feed') gameState.stats.hunger=Math.min(100,gameState.stats.hunger+30);
    if(a==='play') gameState.stats.happiness=Math.min(100,gameState.stats.happiness+25);
    if(a==='clean') gameState.stats.hygiene=Math.min(100,gameState.stats.hygiene+35);
    if(a==='sleep') gameState.stats.energy=Math.min(100,gameState.stats.energy+40);
    update();
}

function saveToFile(){
    const blob=new Blob([JSON.stringify(gameState)],{type:'application/octet-stream'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download=gameState.characterName+'_pet.sps';
    a.click();
    URL.revokeObjectURL(a.href);
}

function exitGame(){
    clearInterval(interval);
    location.reload();
}
</script>
</body>
</html>